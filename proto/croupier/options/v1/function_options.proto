syntax = "proto3";
package croupier.options.v1;
option java_package = "io.github.cuihairu.croupier.options.v1";
option java_multiple_files = true;

import "google/protobuf/descriptor.proto";
import "croupier/common/v1/ui.proto";

option go_package = "github.com/cuihairu/croupier/pkg/pb/croupier/options/v1;optionsv1";

// 方法级元信息（可选）。插件未识别时将使用默认推断。
message FunctionOptions {
  // 全局唯一函数ID（默认：<package>.<service>.<method> 转小写）
  string function_id = 1;
  // 版本（默认 1.0.0）
  string version = 2;
  // 类目（默认取 package 里的第二级，如 games.player.v1 → player）
  string category = 3;
  // 风险级别：low/medium/high（默认 medium）
  string risk = 4;
  // 路由策略：lb/broadcast/targeted/hash（默认 lb）
  string route = 5;
  // 超时（默认 30s）
  string timeout = 6;
  // 两人审批（默认 false）
  bool two_person_rule = 7;
  // 放置位置：core/agent（默认 agent）
  string placement = 8;
  // 额外标签
  map<string,string> labels = 9;
  // 调用模式：query/command（默认 query）
  string mode = 10;
  // 是否启用幂等键（默认 false）
  bool idempotency_key = 11;

  // ========== 展示 & 权限（UI/菜单/权限，强类型定义） ==========
  // 展示名称与摘要（i18n）
  croupier.common.v1.I18nText display_name = 12;
  croupier.common.v1.I18nText summary      = 13;
  // 标签
  repeated string tags = 14;
  // 菜单元数据（用于构建前端菜单）
  croupier.common.v1.Menu menu = 15;
  // 权限规范（verbs/scopes/default role grants/i18n）
  croupier.common.v1.PermissionSpec permissions = 16;
}

// 消息级元信息，用于标记实体类型并生成 entity 描述符
message EntityOptions {
  // 实体ID（默认：<package>.<message> 转小写）
  string entity_id = 1;
  // 版本（默认 1.0.0）
  string version = 2;
  // 实体名称（默认使用 message 名称）
  string name = 3;
  // 描述
  string description = 4;
  // 类目（默认取 package 里的第二级）
  string category = 5;
  // 主键字段（默认取第一个 string 类型的字段）
  string primary_key = 6;
  // 显示字段（用于 UI 展示）
  string display_field = 7;
  // 标题模板（支持 {field_name} 占位符）
  string title_template = 8;
  // 头像字段
  string avatar_field = 9;
  // 状态字段
  string status_field = 10;

  // 操作映射（将 CRUD 操作映射到具体的函数 ID）
  // 创建操作的函数ID列表
  repeated string create_functions = 11;
  // 读取操作的函数ID列表
  repeated string read_functions = 12;
  // 更新操作的函数ID列表
  repeated string update_functions = 13;
  // 删除操作的函数ID列表
  repeated string delete_functions = 14;
  // 列表操作的函数ID列表
  repeated string list_functions = 15;
  // 自定义操作（key: 操作名, value: 函数ID列表）
  map<string, string> custom_operations = 16;

  // 实体展示配置（i18n）
  croupier.common.v1.I18nText display_name = 17;
  croupier.common.v1.I18nText summary = 18;
  // 标签
  repeated string tags = 19;
  // 菜单元数据（用于构建前端菜单）
  croupier.common.v1.Menu menu = 20;
}

extend google.protobuf.MethodOptions {
  FunctionOptions function = 51001;
}

extend google.protobuf.MessageOptions {
  EntityOptions entity = 51002;
}
